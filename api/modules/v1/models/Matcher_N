<?php

namespace api\modules\v1\models;

/**
 * MatcherN - matcher for 5 matches
 *
 * This class provides the functions implementation for a multiple return matcher (fixed number of matches)
 *
 */
 
 class MatcherN implements Matcher
 {
     /**
     * Match 
     * Returns an array with the best 3 matches
     * 
     * @param item => item to be matched
     * @param itemList => possible matches
     *
     * return array
     *
    */
     public function match($item, $itemList)
     {
         $matches = array();
         $lowest_acceptable_compatibility = 0; //compatibility of the Nth most compatible match
         
         foreach ($itemList as $itemB)
         {
            $compatibility = 0;
            $i = 0;
            $n = sizeof($item);
            $match_comparator = new MatchComparator();
            
            //Compares the items attribute per attribute; compatibility receives the sum of attribute similarity
            while($i < $n){
                $compatatibility += $match_comparator->compareAttribute($item[i], $itemB[i]);
                $i++;
            }
           
           //Sum of attribute similarity between the items is divided by the number of attributes, resulting in a number between 0 and 1 (%)
           $compatibility = $compatibility/$n;
           
           //If current item more compatible than Nth most compatible item, the current item replaces it.
           if($compatibility > $lowest_acceptable_compatibility)
           {
               //Add current item to the matches 
               $matches[$compatibility] = $itemB;
               
               //If there are already more than N matches, the one with the lowest compatibility is removed from the array
               if (sizeof($matches) > 3) //In this implementation, N = 3.
               {
                   unset($matches[$lowest_acceptable_compatibility]);
                   $lowest_acceptable_compatibility = min(array_keys($matches));
               }
           }
         }
         
         return $matches;
     }
 }