<?php

namespace api\modules\v1\models;

/**
 * MatcherAll - matcher for all items more than N% compatible
 *
 * This class provides the functions implementation for a multiple return matcher (non-fixed number of matches)
 *
 */
 
 class MatcherAll implements Matcher
 {
     /**
     * Match 
     * Returns an array with the possible matches (above N% compatibility)
     * 
     * @param item => item to be matched
     * @param itemList => possible matches
     *
     * return array
     *
    */
     public function match($item, $itemList)
     {
         $matches = array();
         $lowest_acceptable_compatibility = 0.7; //In this implementation, N = 70%
         
         foreach ($itemList as $itemB)
         {
            $compatibility = 0;
            $i = 0;
            $n = sizeof($item);
            $match_comparator = new MatchComparator();
            
            //Compares the items attribute per attribute; compatibility receives the sum of attribute similarity
            while($i < $n){
                $compatatibility += $match_comparator->compareAttribute($item[i], $itemB[i]);
                $i++;
            }
           
           //Sum of attribute similarity between the items is divided by the number of attributes, resulting in a number between 0 and 1 (%)
           $compatibility = $compatibility/$n;
           
           //If current item N% compatible or more, it gets added to the list
           if($compatibility > $lowest_acceptable_compatibility)
           {
               //Add current item to the matches 
               $matches[$compatibility] = $itemB;
           }
         }
         
         return $matches;
     }
 }